Index: src/Window.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import content.AudioMaster;\r\nimport content.Source;\r\nimport content.Storage;\r\nimport content.Texture;\r\nimport math.AABB;\r\nimport math.CollisionMessage;\r\nimport mobs.*;\r\nimport objects.*;\r\nimport objects.Object;\r\nimport org.lwjgl.glfw.*;\r\nimport org.lwjgl.opengl.*;\r\nimport org.lwjgl.system.*;\r\n\r\nimport java.nio.*;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.Timer;\r\nimport java.util.TimerTask;\r\n\r\nimport static org.lwjgl.glfw.Callbacks.*;\r\nimport static org.lwjgl.glfw.GLFW.*;\r\nimport static org.lwjgl.opengl.GL11.*;\r\nimport static org.lwjgl.system.MemoryStack.*;\r\nimport static org.lwjgl.system.MemoryUtil.*;\r\n\r\npublic class Window {\r\n    private long window;\r\n    SingletonMobs singletonMobs;\r\n    EnemyThread enemyThread;\r\n    SingletonPlayer singletonPlayer;\r\n    private ArrayList<Object> firstLevelObjectList;\r\n    private ArrayList<Object> secondLevelObjectList;\r\n    private ArrayList<Object> shopObjectList;\r\n    private HashMap<String, Integer> textureMap;\r\n    private HashMap<String, Integer> soundMap;\r\n    private HashMap<String, AABB> aabbMap;\r\n    private Container shop;\r\n    Source backgroundMusic, armorChange, coinSound, doorSound, beerSound;\r\n    Coin coinGUI;\r\n    Blacksmith blacksmith;\r\n    Waiter waiter;\r\n    private String level = \"MainMenu\";\r\n    private boolean forScale = true;\r\n    boolean key_E_Pressed = false;\r\n    boolean forMainMenu = true;\r\n    boolean forMainTheme = true;\r\n    private int time = 0;\r\n    private boolean mobSpawnStarted = false;\r\n    private Timer mobTimer = new Timer();\r\n    private TimerTask mobSpawnTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            if (level.equals(\"FirstLevel\")) SingletonMobs.mobList.add(new Slime(350, 300, 1, 50, 0, 5));\r\n            else if (level.equals(\"SecondLevel\")) SingletonMobs.mobList.add(new Spider(477, 284, 1, 60, 0, 10));\r\n            else if (level.equals(\"ForthLevel\")) SingletonMobs.mobList.add(new Imp(477, 284, 1, 60, 0, 30));\r\n            time++;\r\n            if (time == 6) stopMobSpawn();\r\n        }\r\n    };\r\n\r\n    private void stopMobSpawn() {\r\n        time = 0;\r\n        mobTimer.cancel();\r\n        mobTimer.purge();\r\n        mobTimer = new Timer();\r\n        mobSpawnTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                if (level.equals(\"FirstLevel\")) SingletonMobs.mobList.add(new Slime(350, 300, 1, 50, 0, 5));\r\n                else if (level.equals(\"SecondLevel\")) SingletonMobs.mobList.add(new Spider(477, 284, 1, 60, 0, 10));\r\n                else if (level.equals(\"ForthLevel\")) SingletonMobs.mobList.add(new Imp(477, 284, 1, 60, 0, 30));\r\n                time++;\r\n                if (time == 2) stopMobSpawn();\r\n            }\r\n        };\r\n    }\r\n\r\n    public void run() {\r\n        System.out.println(\"Игра запущена\");\r\n\r\n        init();\r\n        loop();\r\n\r\n        glfwFreeCallbacks(window);\r\n        glfwDestroyWindow(window);\r\n\r\n        glfwTerminate();\r\n        glfwSetErrorCallback(null).free();\r\n    }\r\n\r\n    private void init() {\r\n        GLFWErrorCallback.createPrint(System.err).set();\r\n        if (!glfwInit()) throw new IllegalStateException(\"Unable to initialize GLFW\");\r\n\r\n        // Работа с экраном\r\n        window = glfwCreateWindow(1920, 1080, \"Philistine\", glfwGetPrimaryMonitor(), NULL);\r\n        if (window == NULL) throw new RuntimeException(\"Failed to create the GLFW window\");\r\n        try (MemoryStack stack = stackPush()) {\r\n            IntBuffer pWidth = stack.mallocInt(1);\r\n            IntBuffer pHeight = stack.mallocInt(1);\r\n            glfwGetWindowSize(window, pWidth, pHeight);\r\n            GLFWVidMode vidMode = glfwGetVideoMode(glfwGetPrimaryMonitor());\r\n            glfwSetWindowPos(window, (vidMode.width() - pWidth.get(0)) / 2, ((vidMode.height() - pHeight.get(0)) / 2) - 10);\r\n        }\r\n        glfwMakeContextCurrent(window);\r\n        glfwSwapInterval(1);\r\n        glfwShowWindow(window);\r\n\r\n        GL.createCapabilities(); // создает instance для OpenGL в текущем потоке\r\n        glMatrixMode(GL_PROJECTION); // Выставление камеры\r\n        glLoadIdentity(); // По видимости ненужная строка(что-то с единичной матрицей)\r\n        glOrtho(0, 640, 360, 0, 1, -1); // Камера на место окна\r\n        glMatrixMode(GL_MODELVIEW); // Установка матрицы в состояние ModelView\r\n        glEnable(GL_TEXTURE_2D);\r\n        glEnable(GL_BLEND);\r\n        glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA); // Добавляет прозрачность\r\n        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);\r\n        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);\r\n\r\n        // Инициализация всех коллекций\r\n        singletonMobs = SingletonMobs.getInstance();\r\n        textureMap = new HashMap<String, Integer>();\r\n        soundMap = new HashMap<String, Integer>();\r\n        aabbMap = new HashMap<String, AABB>();\r\n        firstLevelObjectList = new ArrayList<Object>();\r\n        secondLevelObjectList = new ArrayList<Object>();\r\n        shopObjectList = new ArrayList<>();\r\n\r\n        AudioMaster.init();\r\n        AudioMaster.setListenerData();\r\n        backgroundMusic = new Source(1);\r\n        armorChange = new Source(0);\r\n        coinSound = new Source(0);\r\n        doorSound = new Source(0);\r\n        beerSound = new Source(0);\r\n        coinGUI = new Coin(\"coin_01\", true, false, 0, 0, 0, 0, new AABB());\r\n        coinGUI.getTimer().schedule(coinGUI.getAnimationTask(), 0, 120);\r\n\r\n        // Единичная загрузка всех текстур\r\n        for (int i = 0, id = 0; i < Storage.textureString.length; i++)\r\n            textureMap.put(Storage.textureString[i], id = Texture.loadTexture(\"textures/\" + Storage.textureString[i]));\r\n\r\n        // Единичная загрузка всех звуков\r\n        for (int i = 0, id = 0; i < Storage.soundString.length; i++)\r\n            soundMap.put(Storage.soundString[i], id = AudioMaster.loadSound(\"sounds/\" + Storage.soundString[i]));\r\n\r\n        // Единичная загрузка всех хитбоксов\r\n        for(int i = 0; i < Storage.aabbString.length; i++)\r\n            aabbMap.put(Storage.aabbString[i], new AABB());\r\n\r\n        // Переходов м/у уровнями\r\n        aabbMap.get(\"entranceToFirstLevel\").update(0, 190, 2, 286);\r\n        aabbMap.get(\"entranceToSecondLevel\").update(638, 238, 640, 335);\r\n        aabbMap.get(\"entranceToThirdLevel\").update(197, 134, 237, 145);\r\n        aabbMap.get(\"entranceToForthLevel\").update(247, 134, 283, 144);\r\n        aabbMap.get(\"entranceFromThirdToSecondLevel\").update(249, 134, 288, 146);\r\n        aabbMap.get(\"entranceFromForthToSecondLevel\").update(199, 132, 236, 141);\r\n        aabbMap.get(\"entranceFromTavernToTown\").update(224,316,255,318);\r\n        aabbMap.get(\"entranceFromForgeToTown\").update(384,316,415,318);\r\n        aabbMap.get(\"toBuyBeer\").update(224, 240, 255, 255);\r\n\r\n        // Добавление всех объектов и мобов\r\n        firstLevelObjectList.add(new Container(\"chest\", false, false, true,250, 200, 282, 232, new AABB(250, 200, 282, 232)));\r\n        firstLevelObjectList.add(new Weapon(\"rapier\", \"slash\", 10, true, true, 150, 150, 342, 342, new AABB(231, 231, 259, 259)));\r\n        firstLevelObjectList.add(new Armor(\"chain_helmet\", \"head\", 4, true, true, 300, 150, 364, 214, 10));\r\n        shop = new Container(\"ChestClosed\", true, true, false, 0, 0, 0, 0, new AABB(0, 0, 0, 0));\r\n        singletonPlayer = SingletonPlayer.getInstance();\r\n        SingletonMobs.mobList.add(SingletonPlayer.player);\r\n        blacksmith = new Blacksmith(176, 126, 1);\r\n        waiter = new Waiter(168, 136, 1);\r\n\r\n        // Клашива ESC на выход(закрытие приложения)\r\n        glfwSetKeyCallback(window, (window, key, scancode, action, mods) -> {\r\n            // Нажатие Escape для открытия/закрытия второстепенного меню\r\n            if (key == GLFW_KEY_ESCAPE && action == GLFW_PRESS && !level.equals(\"MainMenu\"))\r\n                SingletonPlayer.player.setScrollMenu(!SingletonPlayer.player.isScrollMenu());\r\n\r\n            // Нажатие Enter на выход из главного меню\r\n            if (key == GLFW_KEY_ENTER && action == GLFW_PRESS && level.equals(\"MainMenu\")) {\r\n                level = \"Town\";\r\n                backgroundMusic.stop(soundMap.get(\"mainMenuTheme\"));\r\n            }\r\n\r\n            // Нажатие Enter в диалоговом окне(Войти в данж?)\r\n            else if (key == GLFW_KEY_ENTER && action == GLFW_PRESS && level.equals(\"Town\") &&\r\n                    SingletonPlayer.player.isChoiceBubble()) {\r\n                SingletonPlayer.player.setX(SingletonPlayer.player.getX() - 1);\r\n                SingletonPlayer.player.setChoiceBubble(false);\r\n                if (SingletonPlayer.player.isYes()) {\r\n                    level = \"FirstLevel\";\r\n                    glTranslated(SingletonPlayer.player.getForPlacingCamera(), 0, 0);\r\n                    SingletonPlayer.player.setX(150);\r\n                    SingletonPlayer.player.setY(150);\r\n                    SingletonPlayer.player.setSpeed(2);\r\n                }\r\n                // Установление хитбоксов стен первого уровня\r\n                for(int i = 0, j = 0; i < 5; i++, j+=4)\r\n                    aabbMap.get(\"wall\" + i).update(Storage.firstLevelWalls[j], Storage.firstLevelWalls[j + 1], Storage.firstLevelWalls[j + 2], Storage.firstLevelWalls[j + 3]);\r\n            }\r\n\r\n            // Нажатие Enter во второстепенном меню\r\n            else if (key == GLFW_KEY_ENTER && action == GLFW_PRESS && SingletonPlayer.player.isScrollMenu()) {\r\n                switch (SingletonPlayer.player.getMenuChoice()) {\r\n                    case \"Resume\": {\r\n                        SingletonPlayer.player.setScrollMenu(false);\r\n                        break;\r\n                    }\r\n                    case \"Options\": {\r\n                        break;\r\n                    }\r\n                    case \"Exit\": {\r\n                        AudioMaster.destroy();\r\n                        glfwSetWindowShouldClose(window, true);\r\n                        for (Mob mob : SingletonMobs.mobList) {\r\n                            if (!mob.isDead()) {\r\n                                mob.getTimer().cancel();\r\n                                mob.getTimer().purge();\r\n                            }\r\n                        }\r\n                        for (Object object : firstLevelObjectList) {\r\n                            if (object instanceof Coin) {\r\n                                object.getTimer().cancel();\r\n                                object.getTimer().purge();\r\n                            }\r\n                        }\r\n                        System.exit(0);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Атака\r\n            if (key == GLFW_KEY_LEFT && action == GLFW_PRESS && !level.equals(\"MainMenu\") && !level.equals(\"Town\") &&\r\n                    !level.equals(\"tavern\") && !level.equals(\"forge\")) {\r\n                if (!SingletonPlayer.player.isAttackRight() && !SingletonPlayer.player.isAttackUp() && !SingletonPlayer.player.isAttackDown()) {\r\n                    SingletonPlayer.player.setAttackLeft(true);\r\n                    SingletonPlayer.player.setMoveDirection(\"left\");\r\n                }\r\n            }\r\n\r\n            // Выбор в диалоговом окне\r\n            else if (key == GLFW_KEY_LEFT && action == GLFW_PRESS && level.equals(\"Town\")) {\r\n                if (SingletonPlayer.player.isChoiceBubble()) SingletonPlayer.player.setYes(!SingletonPlayer.player.isYes());\r\n            }\r\n\r\n            // Атака\r\n            if (key == GLFW_KEY_RIGHT && action == GLFW_PRESS && !level.equals(\"MainMenu\") && !level.equals(\"Town\") &&\r\n                    !level.equals(\"tavern\") && !level.equals(\"forge\")) {\r\n                if (!SingletonPlayer.player.isAttackLeft() && !SingletonPlayer.player.isAttackUp() &&\r\n                        !SingletonPlayer.player.isAttackDown()) {\r\n                    SingletonPlayer.player.setAttackRight(true);\r\n                    SingletonPlayer.player.setMoveDirection(\"right\");\r\n                }\r\n            }\r\n\r\n            // Выбор в диалоговом окне\r\n            else if (key == GLFW_KEY_RIGHT && action == GLFW_PRESS && level.equals(\"Town\")) {\r\n                if (SingletonPlayer.player.isChoiceBubble()) SingletonPlayer.player.setYes(!SingletonPlayer.player.isYes());\r\n            }\r\n\r\n            // Нажатие стрелки вверх во второстепенном меню\r\n            if (key == GLFW_KEY_UP && action == GLFW_PRESS && SingletonPlayer.player.isScrollMenu()) {\r\n                switch (SingletonPlayer.player.getMenuChoice()) {\r\n                    case \"Resume\": {\r\n                        SingletonPlayer.player.setMenuChoice(\"Exit\");\r\n                        break;\r\n                    }\r\n                    case \"Options\": {\r\n                        SingletonPlayer.player.setMenuChoice(\"Resume\");\r\n                        break;\r\n                    }\r\n                    case \"Exit\": {\r\n                        SingletonPlayer.player.setMenuChoice(\"Options\");\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Атака\r\n            else if (key == GLFW_KEY_UP && action == GLFW_PRESS && !level.equals(\"MainMenu\") && !level.equals(\"Town\") &&\r\n                    !level.equals(\"tavern\") && !level.equals(\"forge\")) {\r\n                if (!SingletonPlayer.player.isAttackLeft() && !SingletonPlayer.player.isAttackRight() &&\r\n                        !SingletonPlayer.player.isAttackDown()) {\r\n                    SingletonPlayer.player.setAttackUp(true);\r\n                    SingletonPlayer.player.setMoveDirection(\"up\");\r\n                }\r\n            }\r\n\r\n            // Нажатие стрелки вниз во второстепенном меню\r\n            if (key == GLFW_KEY_DOWN && action == GLFW_PRESS && SingletonPlayer.player.isScrollMenu()) {\r\n                switch (SingletonPlayer.player.getMenuChoice()) {\r\n                    case \"Resume\": {\r\n                        SingletonPlayer.player.setMenuChoice(\"Options\");\r\n                        break;\r\n                    }\r\n                    case \"Options\": {\r\n                        SingletonPlayer.player.setMenuChoice(\"Exit\");\r\n                        break;\r\n                    }\r\n                    case \"Exit\": {\r\n                        SingletonPlayer.player.setMenuChoice(\"Resume\");\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Атака\r\n            else if (key == GLFW_KEY_DOWN && action == GLFW_PRESS && !level.equals(\"MainMenu\") && !level.equals(\"Town\") &&\r\n                    !level.equals(\"tavern\") && !level.equals(\"forge\")) {\r\n                if (!SingletonPlayer.player.isAttackLeft() && !SingletonPlayer.player.isAttackRight() &&\r\n                        !SingletonPlayer.player.isAttackUp()) {\r\n                    SingletonPlayer.player.setAttackDown(true);\r\n                    SingletonPlayer.player.setMoveDirection(\"down\");\r\n                }\r\n            }\r\n\r\n            if (key == GLFW_KEY_E && action == GLFW_PRESS && !level.equals(\"MainMenu\")) key_E_Pressed = true;\r\n        });\r\n    }\r\n\r\n    private synchronized void loop() {\r\n        int torch_i = 1, torch_g = 0, guard_i = 1, guard_g = 0, forgeFurnace_i = 1, forgeFurnace_g = 0;\r\n\r\n        while (!glfwWindowShouldClose(window)) {\r\n            glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);\r\n\r\n            // Переключение уровня\r\n            switch (level) {\r\n                case \"MainMenu\": {\r\n                    if (forMainTheme) {\r\n                        backgroundMusic.play(soundMap.get(\"mainMenuTheme\"));\r\n                        forMainTheme = false;\r\n                    }\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"MainMenu\")); // Фон главного меню\r\n                    createQuadTexture(0, 0, 1536, 360);\r\n\r\n                    // Анимация охранника\r\n                    if (guard_i == 11) guard_i = 1;\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"guard_stand_0\" + guard_i));\r\n                    createQuadTexture(30, 190, 62, 224);\r\n                    if (guard_g == 10) {\r\n                        guard_i++;\r\n                        guard_g = 0;\r\n                    }\r\n                    guard_g++;\r\n\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"Philistine\"));\r\n                    createQuadTexture(SingletonPlayer.player.getX() - 68, SingletonPlayer.player.getY() - 156, SingletonPlayer.player.getX() + 64 + 68, SingletonPlayer.player.getY() - 100);\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"Press_enter\"));\r\n                    createQuadTexture(SingletonPlayer.player.getX() - 18, SingletonPlayer.player.getY() - 100, SingletonPlayer.player.getX() + 82, SingletonPlayer.player.getY() - 72);\r\n                    if (SingletonPlayer.player.getX() == 1186) forMainMenu = false;\r\n                    else if (SingletonPlayer.player.getX() == 290) forMainMenu = true;\r\n                    if (forMainMenu) {\r\n                        glTranslated(-1, 0, 0);\r\n                        SingletonPlayer.player.setForPlacingCamera(SingletonPlayer.player.getForPlacingCamera() + 1);\r\n                        SingletonPlayer.player.setMainMenuDirection(true);\r\n                    }\r\n                    else {\r\n                        glTranslated(1, 0, 0);\r\n                        SingletonPlayer.player.setForPlacingCamera(SingletonPlayer.player.getForPlacingCamera() - 1);\r\n                        SingletonPlayer.player.setMainMenuDirection(false);\r\n                    }\r\n                    break;\r\n                }\r\n                case \"Town\": {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"MainMenu\")); // Фон главного меню\r\n                    createQuadTexture(0, 0, 1536, 360);\r\n\r\n                    // Анимация охранника\r\n                    if (guard_i == 11) guard_i = 1;\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"guard_stand_0\" + guard_i));\r\n                    createQuadTexture(30, 190, 62, 224);\r\n                    if (guard_g == 10) {\r\n                        guard_i++;\r\n                        guard_g = 0;\r\n                    }\r\n                    guard_g++;\r\n\r\n                    // Левая граница города\r\n                    if (SingletonPlayer.player.getX() <= 48) SingletonPlayer.player.stopLeft();\r\n                    if (SingletonPlayer.player.getX() <= 50) {\r\n                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"you_Shall_Not_Pass\"));\r\n                        createQuadTexture(34, 136, 94, 195);\r\n                    }\r\n                    // Переход в данж\r\n                    if (SingletonPlayer.player.getX() + 32 == 1519) {\r\n                        SingletonPlayer.player.setChoiceBubble(true);\r\n                        if (SingletonPlayer.player.isYes()) glBindTexture(GL_TEXTURE_2D, textureMap.get(\"enterTheDungeon_Yes\"));\r\n                        else if (!SingletonPlayer.player.isYes()) glBindTexture(GL_TEXTURE_2D, textureMap.get(\"enterTheDungeon_No\"));\r\n                        createQuadTexture(SingletonPlayer.player.getX() - 20, SingletonPlayer.player.getY() - 55, SingletonPlayer.player.getX() + 40, SingletonPlayer.player.getY());\r\n                    }\r\n\r\n                    if (key_E_Pressed) {\r\n                        // Вхождение в таверну\r\n                        if (SingletonPlayer.player.getX() + 32 > 305 && SingletonPlayer.player.getX() + 32 < 341) {\r\n                            level = \"tavern\";\r\n                            glTranslated(SingletonPlayer.player.getForPlacingCamera(), 0, 0);\r\n                            SingletonPlayer.player.setForPlacingCamera(3);\r\n\r\n                            // Обновление хитбоксов стен для tavern\r\n                            for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                                aabbMap.get(\"wall\" + i).update(Storage.tavernLevelWalls[j], Storage.tavernLevelWalls[j + 1],\r\n                                        Storage.tavernLevelWalls[j + 2], Storage.tavernLevelWalls[j + 3]);\r\n                            }\r\n                            doorSound.play(soundMap.get(\"doorOpen\"));\r\n                            SingletonPlayer.player.setX(210);\r\n                            SingletonPlayer.player.setY(254);\r\n                            SingletonPlayer.player.setMoveDirection(\"up\");\r\n                        }\r\n                        // Вхождение в кузницу\r\n                        else if (SingletonPlayer.player.getX() + 32 > 620 && SingletonPlayer.player.getX() + 32 < 651) {\r\n                            level = \"forge\";\r\n                            glTranslated(SingletonPlayer.player.getForPlacingCamera(), 0, 0);\r\n                            SingletonPlayer.player.setForPlacingCamera(315);\r\n\r\n                            // Обновление хитбоксов стен для forge\r\n                            for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                                aabbMap.get(\"wall\" + i).update(Storage.forgeLevelWalls[j], Storage.forgeLevelWalls[j + 1],\r\n                                        Storage.forgeLevelWalls[j + 2], Storage.forgeLevelWalls[j + 3]);\r\n                            }\r\n                            doorSound.play(soundMap.get(\"doorOpen\"));\r\n                            SingletonPlayer.player.setX(368);\r\n                            SingletonPlayer.player.setY(254);\r\n                            SingletonPlayer.player.setMoveDirection(\"up\");\r\n                        }\r\n                    }\r\n                    key_E_Pressed = false;\r\n                    break;\r\n                }\r\n                case \"tavern\": {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"tavern\")); // Фон таверны\r\n                    createQuadTexture(0, 0, 640, 360);\r\n\r\n                    // Отрисовка оффицианта и остановка около прилавка\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"waiter_\" + waiter.getMoveDirection() + \"_move_0\" + waiter.getAnimationTime()));\r\n                    createQuadTexture(waiter.getX(), waiter.getY(), waiter.getX() + 64, waiter.getY() + 64);\r\n                    waiter.simulateBehavior();\r\n                    if (waiter.isWaitingTaskStarted()) {\r\n                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"emotion_question\"));\r\n                        createQuadTexture(waiter.getX() + 31, waiter.getY(), waiter.getX() + 51, waiter.getY() + 20);\r\n\r\n                        // Восстановить здоровье\r\n                        if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"toBuyBeer\"))) {\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"emotion_health\")); // Фон таверны\r\n                            createQuadTexture(SingletonPlayer.player.getX() + 32, SingletonPlayer.player.getY(),\r\n                                    SingletonPlayer.player.getX() + 52, SingletonPlayer.player.getY() + 20);\r\n                            if (key_E_Pressed && SingletonPlayer.player.getHealth() < 100 && SingletonPlayer.player.getMoney() >= 10) {\r\n                                SingletonPlayer.player.setHealth(100);\r\n                                SingletonPlayer.player.setMoney(SingletonPlayer.player.getMoney() - 10);\r\n                                beerSound.play(soundMap.get(\"drinkBeer\"));\r\n                            }\r\n                        }\r\n                    }\r\n                    key_E_Pressed = false;\r\n\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"gentleman_brown\"));\r\n                    createQuadTexture(350, 190, 350 + 64, 190 + 64);\r\n\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall3\")) || AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall5\")))\r\n                        SingletonPlayer.player.stopRight();\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall1\")) || AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall6\")))\r\n                        SingletonPlayer.player.stopLeft();\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall2\")))\r\n                        SingletonPlayer.player.stopUp();\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                        SingletonPlayer.player.stopDown();\r\n\r\n                    // Проверка выхода в город\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceFromTavernToTown\"))) {\r\n                        level = \"Town\";\r\n                        // Обновление хитбоксов стен для города\r\n                        for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.townLevelWalls[j], Storage.townLevelWalls[j + 1],\r\n                                    Storage.townLevelWalls[j + 2], Storage.townLevelWalls[j + 3]);\r\n                        }\r\n                        doorSound.play(soundMap.get(\"doorOpen\"));\r\n                        glTranslated(-SingletonPlayer.player.getForPlacingCamera(), 0, 0);\r\n                        SingletonPlayer.player.setX(293);\r\n                        SingletonPlayer.player.setY(192);\r\n                        SingletonPlayer.player.setMoveDirection(\"right\");\r\n                    }\r\n                    break;\r\n                }\r\n                case \"forge\": {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"forge\")); // Фон кузницы\r\n                    createQuadTexture(0, 0, 640, 360);\r\n\r\n                    // Анимация печки\r\n                    if (forgeFurnace_i == 4) forgeFurnace_i = 1;\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"furnace_burn_0\" + forgeFurnace_i));\r\n                    createQuadTexture(223, 142, 259, 173);\r\n                    if (forgeFurnace_g == 12) {\r\n                        forgeFurnace_i++;\r\n                        forgeFurnace_g = 0;\r\n                    }\r\n                    forgeFurnace_g++;\r\n\r\n                    // Отрисовка кузнеца и остановка около прилавка\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"blacksmith_\" + blacksmith.getMoveDirection() + \"_move_0\" + blacksmith.getAnimationTime()));\r\n                    createQuadTexture(blacksmith.getX(), blacksmith.getY(), blacksmith.getX() + 64, blacksmith.getY() + 64);\r\n                    blacksmith.simulateBehavior();\r\n                    if (blacksmith.isWaitingTaskStarted()) {\r\n                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"emotion_question\"));\r\n                        createQuadTexture(blacksmith.getX() + 31, blacksmith.getY(), blacksmith.getX() + 51, blacksmith.getY() + 20);\r\n                    }\r\n\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall6\")) || AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                        SingletonPlayer.player.stopRight();\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall2\")))\r\n                        SingletonPlayer.player.stopLeft();\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall3\")))\r\n                        SingletonPlayer.player.stopUp();\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall1\")) || AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"wall5\")))\r\n                        SingletonPlayer.player.stopDown();\r\n\r\n                    if (shop.loot.size() != 0) {\r\n                        shopObjectList.addAll(shop.loot);\r\n                        shop.loot.clear();\r\n                    }\r\n\r\n                    for (Object object : shopObjectList) {\r\n                        if (!object.isLying()) continue;\r\n                        else glBindTexture(GL_TEXTURE_2D, textureMap.get(object.getTexture()));\r\n                        createQuadTexture(object.getMinX(), object.getMinY(), object.getMaxX(), object.getMaxY());\r\n                    }\r\n\r\n                    for (int i = 0; i < shopObjectList.size(); i++) {\r\n                        if (!shopObjectList.get(i).isLying()) continue;\r\n                        if (shopObjectList.get(i) instanceof Armor && AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(),\r\n                                shopObjectList.get(i).getCollisionBox())) {\r\n                            Armor tempArmor = (Armor) shopObjectList.get(i);\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"price\"));\r\n                            createQuadTexture(tempArmor.getMinX() + 15 ,tempArmor.getCollisionBox().getMin().y - 27, tempArmor.getMinX() + 45,  tempArmor.getCollisionBox().getMin().y);\r\n                            int tempX0, tempX1, tempY0, tempY1;\r\n                            tempX0 = tempArmor.getMinX() + 37 - 7;\r\n                            tempX1 = tempArmor.getMinX() + 37;\r\n                            tempY0 = tempArmor.getCollisionBox().getMin().y - 13;\r\n                            tempY1 = tempArmor.getCollisionBox().getMin().y - 3;\r\n                            int tempPrice = tempArmor.getPrice();\r\n                            for (int j = 0; j < getCountsOfDigits(tempArmor.getPrice()); j++) {\r\n                                switch (tempPrice % 10) {\r\n                                    case 0:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_0\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 1:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_1\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 2:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_2\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 3:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_3\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 4:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_4\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 5:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_5\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 6:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_6\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 7:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_7\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 8:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_8\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n                                    case 9:\r\n                                        glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_9\"));\r\n                                        createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                                        break;\r\n\r\n                                }\r\n                                tempPrice = tempPrice / 10;\r\n                                tempX0 -= 7;\r\n                                tempX1 -= 7;\r\n                            }\r\n                            if (key_E_Pressed && SingletonPlayer.player.getMoney() >= tempArmor.getPrice()) {\r\n                                SingletonPlayer.player.setMoney(SingletonPlayer.player.getMoney() - tempArmor.getPrice());\r\n                                SingletonPlayer.player.setArmor(tempArmor);\r\n                                shopObjectList.get(i).setIsLying(false);\r\n                                shopObjectList.remove(i);\r\n                                armorChange.play(soundMap.get(\"changingArmor\"));\r\n                                key_E_Pressed = false;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Проверка выхода в город\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceFromForgeToTown\"))) {\r\n                        level = \"Town\";\r\n                        // Обновление хитбоксов стен для города\r\n                        for (int i = 0, j = 0; i < 7; i++, j += 4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.townLevelWalls[j], Storage.townLevelWalls[j + 1],\r\n                                    Storage.townLevelWalls[j + 2], Storage.townLevelWalls[j + 3]);\r\n                        }\r\n                        doorSound.play(soundMap.get(\"doorOpen\"));\r\n                        glTranslated(-SingletonPlayer.player.getForPlacingCamera(), 0, 0);\r\n                        SingletonPlayer.player.setX(605);\r\n                        SingletonPlayer.player.setY(192);\r\n                        SingletonPlayer.player.setMoveDirection(\"right\");\r\n                    }\r\n                    break;\r\n                }\r\n                case \"FirstLevel\": {\r\n                    if (!forMainTheme) {\r\n                        backgroundMusic.changeVolume(0.1f);\r\n                        backgroundMusic.play(soundMap.get(\"dungeonAmbient1\"));\r\n                        forMainTheme = true;\r\n                    }\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"level0\")); // Фон первого уровня\r\n                    createQuadTexture(0, 0, 640, 360);\r\n\r\n                    //Анимация факела\r\n                    if (torch_i == 10) torch_i = 1;\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"torch_0\" + torch_i));\r\n                    createQuadTexture(190, 63, 221, 126);\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"torch_0\" + torch_i));\r\n                    createQuadTexture(384, 63, 415, 126);\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"torch_0\" + torch_i));\r\n                    createQuadTexture(556, 158, 587, 221);\r\n                    if (torch_g == 8) {\r\n                        torch_i++;\r\n                        torch_g = 0;\r\n                    }\r\n                    torch_g++;\r\n\r\n                    if (!mobSpawnStarted) {\r\n                        mobSpawnStarted = true;\r\n                        mobTimer.schedule(mobSpawnTask, 0, 5000);\r\n                    }\r\n\r\n                    // Отрисовка всех объектов\r\n                    for (Object object : firstLevelObjectList) {\r\n                        if (!object.isLying()) continue;\r\n                        if (object instanceof Coin) {\r\n                            Coin coin = (Coin) object;\r\n                            if (!coin.isAnimationTaskStarted())\r\n                                coin.getTimer().schedule(coin.getAnimationTask(), 0, 120);\r\n                            coin.setTexture(\"coin_0\" + coin.getAnimationTime());\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(coin.getTexture()));\r\n                        }\r\n                        else if (object instanceof Container) {\r\n                            Container container = (Container) object;\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(container.getTexture() + container.getState()));\r\n                        }\r\n                        else glBindTexture(GL_TEXTURE_2D, textureMap.get(object.getTexture()));\r\n                        createQuadTexture(object.getMinX(), object.getMinY(), object.getMaxX(), object.getMaxY());\r\n                    }\r\n\r\n                    // Подбор всех возможных предметов с клавишей Е\r\n                    if (key_E_Pressed) {\r\n                        for (int i = 0; i < firstLevelObjectList.size(); i++) {\r\n                            if (firstLevelObjectList.get(i) instanceof Armor) {\r\n                                Armor changingArmor = (Armor) firstLevelObjectList.get(i);\r\n                                if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), changingArmor.getCollisionBox())) {\r\n                                    Armor playerArmor = SingletonPlayer.player.getArmorType(changingArmor);\r\n                                    changingArmor.setIsLying(false);\r\n                                    SingletonPlayer.player.setArmor(changingArmor);\r\n                                    armorChange.play(soundMap.get(\"changingArmor\"));\r\n                                    changingArmor = playerArmor;\r\n                                    if (changingArmor.getTexture().equals(\"nothing\")) firstLevelObjectList.remove(i);\r\n                                    else {\r\n                                        changingArmor.setMinX(SingletonPlayer.player.getCollisionBox().getMin().x - 20);\r\n                                        changingArmor.setMinY(SingletonPlayer.player.getCollisionBox().getMin().y - 30);\r\n                                        changingArmor.setMaxX(SingletonPlayer.player.getCollisionBox().getMin().x + 44);\r\n                                        changingArmor.setMaxY(SingletonPlayer.player.getCollisionBox().getMin().y + 34);\r\n                                        changingArmor.setIsLying(true);\r\n                                        changingArmor.correctCollisionBox();\r\n                                        firstLevelObjectList.set(i, changingArmor);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                            else if (firstLevelObjectList.get(i) instanceof Weapon) {\r\n                                Weapon changingWeapon = (Weapon) firstLevelObjectList.get(i);\r\n                                if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), changingWeapon.getCollisionBox())) {\r\n                                    Weapon playerWeapon = SingletonPlayer.player.getWeapon();\r\n                                    changingWeapon.setIsLying(false);\r\n                                    changingWeapon.resize();\r\n                                    SingletonPlayer.player.setWeapon(changingWeapon);\r\n                                    armorChange.play(soundMap.get(\"changingArmor\"));\r\n                                    changingWeapon = playerWeapon;\r\n                                    if (changingWeapon.getTexture().equals(\"nothing\")) firstLevelObjectList.remove(i);\r\n                                    else {\r\n                                        changingWeapon.setMinX(SingletonPlayer.player.getCollisionBox().getMin().x - 64);\r\n                                        changingWeapon.setMinY(SingletonPlayer.player.getCollisionBox().getMin().y - 64);\r\n                                        changingWeapon.setMaxX(SingletonPlayer.player.getCollisionBox().getMin().x + 128);\r\n                                        changingWeapon.setMaxY(SingletonPlayer.player.getCollisionBox().getMin().y + 128);\r\n                                        changingWeapon.setIsLying(true);\r\n                                        changingWeapon.correctCollisionBox();\r\n                                        firstLevelObjectList.set(i, changingWeapon);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                            else if (firstLevelObjectList.get(i) instanceof Container && SingletonPlayer.player.getKeys() > 0) {\r\n                                Container change = (Container) firstLevelObjectList.get(i);\r\n                                if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), change.getCollisionBox())) {\r\n                                    change.setState(\"Opened\");\r\n                                    SingletonPlayer.player.setKeys(SingletonPlayer.player.getKeys() - 1);\r\n                                    for (int h = 0; h < change.loot.size(); h++) {\r\n                                        firstLevelObjectList.add(change.loot.get(h));\r\n                                        change.loot.remove(h);\r\n                                        h--;\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    key_E_Pressed = false;\r\n\r\n                    // Все операции с мобами\r\n                    for (int i = 1; i < SingletonMobs.mobList.size(); i++) {\r\n                        if (!SingletonMobs.mobList.get(i).isDead()) {\r\n                            if (SingletonMobs.mobList.get(i) instanceof Slime) {\r\n                                Slime slime = (Slime) SingletonMobs.mobList.get(i);\r\n                                glBindTexture(GL_TEXTURE_2D, textureMap.get(\"slime_\" + slime.getMoveDirection() + \"_0\" + slime.getAnimationTime()));\r\n                                createQuadTexture(slime.getX(), slime.getY(), slime.getX() + 18, slime.getY() + 12);\r\n                                slime.update();\r\n\r\n                                // Игрок получает урона от слизня\r\n                                if (AABB.AABBvsAABB(SingletonPlayer.player.getHitbox(), slime.getHitbox()) &&\r\n                                        !SingletonPlayer.player.isDead() && !SingletonPlayer.player.isImmortal()) {\r\n                                    if (SingletonPlayer.player.getX() > slime.getX()) SingletonPlayer.player.setKnockbackDirection(\"right\");\r\n                                    else if (SingletonPlayer.player.getX() < slime.getX()) SingletonPlayer.player.setKnockbackDirection(\"left\");\r\n                                    else if (SingletonPlayer.player.getY() > slime.getY()) SingletonPlayer.player.setKnockbackDirection(\"down\");\r\n                                    else if (SingletonPlayer.player.getY() < slime.getY()) SingletonPlayer.player.setKnockbackDirection(\"up\");\r\n                                    SingletonPlayer.player.takeDamage(slime.getDamage());\r\n                                    if (!SingletonPlayer.player.isKnockbackTaskStarted()) {\r\n                                        SingletonPlayer.player.setImmortal(true);\r\n                                        SingletonPlayer.player.getTimer().schedule(SingletonPlayer.player.getKnockbackTask(), 0, 10);\r\n                                    }\r\n                                }\r\n\r\n                                // Смэрть\r\n                                if (slime.getHealth() <= 0) {\r\n                                    slime.setDead(true);\r\n                                    SingletonMobs.mobList.remove(slime);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Проверка всех мобов на столкновение со стенами, объектами. Столкновения объектов с объектами\r\n                    for (int i1 = 0; i1 < SingletonMobs.mobList.size(); i1++) {\r\n                        Mob mob = SingletonMobs.mobList.get(i1);\r\n\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall1\")))\r\n                            mob.stopRight();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                            mob.stopLeft();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall2\")))\r\n                            mob.stopUp();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall3\")))\r\n                            mob.stopDown();\r\n\r\n                        for (int i = 0; i < firstLevelObjectList.size(); i++) {\r\n                            Object object = firstLevelObjectList.get(i);\r\n                            if (!(object instanceof Furniture) && !(object instanceof Container)) {\r\n                                // Столкновение объектов со стенами\r\n                                if (AABB.AABBvsAABB(object.getCollisionBox(), aabbMap.get(\"wall1\")))\r\n                                    object.stopRight();\r\n                                if (AABB.AABBvsAABB(object.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                                    object.stopLeft();\r\n                                if (AABB.AABBvsAABB(object.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(object.getCollisionBox(), aabbMap.get(\"wall2\")))\r\n                                    object.stopUp();\r\n                                if (AABB.AABBvsAABB(object.getCollisionBox(), aabbMap.get(\"wall3\")))\r\n                                    object.stopDown();\r\n\r\n                                // Столкновение объектов с объектами\r\n                                for (int j = i + 1; j < firstLevelObjectList.size(); j++) {\r\n                                    Object object2 = firstLevelObjectList.get(j);\r\n                                    if (!(object2 instanceof Furniture) && !(object2 instanceof Container)) {\r\n                                        if (AABB.AABBvsAABB(object.getCollisionBox(), object2.getCollisionBox()))\r\n                                            object.moveLeft();\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            if (AABB.AABBvsAABB(mob.getCollisionBox(), object.getCollisionBox())) {\r\n                                if ((mob instanceof Player) && (object instanceof Coin)) {\r\n                                    object.getTimer().cancel();\r\n                                    object.getTimer().purge();\r\n                                    firstLevelObjectList.remove(object);\r\n                                    SingletonPlayer.player.setMoney(SingletonPlayer.player.getMoney() + 10);\r\n                                    coinSound.play(soundMap.get(\"pickedCoin\"));\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            if (AABB.AABBvsAABB(mob.getCollisionBox(), object.getCollisionBox())) {\r\n                                if ((mob instanceof Player) && (object instanceof Potion)) {\r\n                                    object.getTimer().cancel();\r\n                                    object.getTimer().purge();\r\n                                    firstLevelObjectList.remove(object);\r\n                                    if (SingletonPlayer.player.getHealth() > 90)\r\n                                        SingletonPlayer.player.setHealth(100);\r\n                                    else\r\n                                        SingletonPlayer.player.setHealth(SingletonPlayer.player.getHealth() + 10);\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            if (object.isNoclip()) continue;\r\n                            if (AABB.AABBvsAABB2(mob.getCollisionBox(), object.getCollisionBox()))\r\n                                mob.stop(CollisionMessage.getMessage());\r\n                        }\r\n                    }\r\n\r\n                    // Проверка перехода на второй уровень\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceToSecondLevel\"))) {\r\n                        level = \"SecondLevel\";\r\n                        mobSpawnStarted = false;\r\n                        // Обновление хитбоксов стен для второго уровня\r\n                        for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.secondLevelWalls[j], Storage.secondLevelWalls[j + 1],\r\n                                    Storage.secondLevelWalls[j + 2], Storage.secondLevelWalls[j + 3]);\r\n                        }\r\n                        SingletonPlayer.player.setX(2 - 14);\r\n                        SingletonPlayer.player.setY(225);\r\n                    }\r\n                    break;\r\n                }\r\n                case \"SecondLevel\": {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"level1\")); // Фон второго уровня\r\n                    createQuadTexture(0, 0, 640, 360);\r\n\r\n                    if (!mobSpawnStarted) {\r\n                        mobSpawnStarted = true;\r\n                        mobTimer.schedule(mobSpawnTask, 3000, 10000);\r\n                    }\r\n\r\n                    // Все операции с мобами\r\n                    for (int i = 1; i < SingletonMobs.mobList.size(); i++) {\r\n                        if (!SingletonMobs.mobList.get(i).isDead()) {\r\n                            if (SingletonMobs.mobList.get(i) instanceof Spider) {\r\n                                Spider spider = (Spider) SingletonMobs.mobList.get(i);\r\n                                if (spider.isAttackLeft() || spider.isAttackRight() || spider.isAttackUp() || spider.isAttackDown()) glBindTexture(GL_TEXTURE_2D, textureMap.get(\"spider_\" + spider.getMoveDirection() + \"_attack_0\" + spider.getHitAnimationTime()));\r\n                                else glBindTexture(GL_TEXTURE_2D, textureMap.get(\"spider_\" + spider.getMoveDirection() + \"_move_0\" + spider.getAnimationTime()));\r\n                                createQuadTexture(spider.getX(), spider.getY(), spider.getX() + 64, spider.getY() + 64);\r\n                                spider.update();\r\n\r\n                                // Игрок получает урона от паука\r\n                                if (AABB.AABBvsAABB(SingletonPlayer.player.getHitbox(), spider.getAttackBox()) &&\r\n                                        !SingletonPlayer.player.isDead() && !SingletonPlayer.player.isImmortal()) {\r\n                                    if (spider.isAttackLeft()) SingletonPlayer.player.setKnockbackDirection(\"left\");\r\n                                    else if (spider.isAttackRight()) SingletonPlayer.player.setKnockbackDirection(\"right\");\r\n                                    else if (spider.isAttackUp()) SingletonPlayer.player.setKnockbackDirection(\"up\");\r\n                                    else if (spider.isAttackDown()) SingletonPlayer.player.setKnockbackDirection(\"down\");\r\n                                    SingletonPlayer.player.takeDamage(spider.getDamage());\r\n                                    if (!SingletonPlayer.player.isKnockbackTaskStarted()) {\r\n                                        SingletonPlayer.player.setImmortal(true);\r\n                                        SingletonPlayer.player.getTimer().schedule(SingletonPlayer.player.getKnockbackTask(), 0, 10);\r\n                                    }\r\n                                }\r\n\r\n                                // Смэрть\r\n                                if (spider.getHealth() <= 0) {\r\n                                    spider.setDead(true);\r\n                                    /*spider.getTimer().cancel();\r\n                                    spider.getTimer().purge();*/\r\n                                    SingletonMobs.mobList.remove(spider);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Проверка всех мобов на столкновение со стенами\r\n                    for (int i1 = 0; i1 < SingletonMobs.mobList.size(); i1++) {\r\n                        Mob mob = SingletonMobs.mobList.get(i1);\r\n\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall3\")))\r\n                            mob.stopRight();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall1\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall5\")))\r\n                            mob.stopLeft();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall2\")))\r\n                            mob.stopUp();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall6\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                            mob.stopDown();\r\n                    }\r\n\r\n                    // Проверка перехода на первый уровень\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceToFirstLevel\"))) {\r\n                        level = \"FirstLevel\";\r\n                        // Обновление хитбоксов стен для первого уровня\r\n                        for(int i = 0, j = 0; i < 5; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.firstLevelWalls[j], Storage.firstLevelWalls[j + 1],\r\n                                    Storage.firstLevelWalls[j + 2], Storage.firstLevelWalls[j + 3]);\r\n                        }\r\n                        SingletonPlayer.player.setX(638 - 64 + 15);\r\n                        SingletonPlayer.player.setY(281);\r\n                    }\r\n\r\n                    // Проверка перехода на 3 уровень\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceToThirdLevel\"))) {\r\n                        level = \"ThirdLevel\";\r\n                        // Обновление хитбоксов стен для 3 уровня\r\n                        for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.thirdLevelWalls[j], Storage.thirdLevelWalls[j + 1],\r\n                                    Storage.thirdLevelWalls[j + 2], Storage.thirdLevelWalls[j + 3]);\r\n                        }\r\n                        SingletonPlayer.player.setX(240);\r\n                        SingletonPlayer.player.setY(120);\r\n                        SingletonPlayer.player.setMoveDirection(\"down\");\r\n                    }\r\n\r\n                    // Проверка перехода на 4 уровень\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceToForthLevel\"))) {\r\n                        level = \"ForthLevel\";\r\n                        // Обновление хитбоксов стен для 4 уровня\r\n                        for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.fourthLevelWalls[j], Storage.fourthLevelWalls[j + 1],\r\n                                    Storage.fourthLevelWalls[j + 2], Storage.fourthLevelWalls[j + 3]);\r\n                        }\r\n                        SingletonPlayer.player.setX(180);\r\n                        SingletonPlayer.player.setY(120);\r\n                        SingletonPlayer.player.setMoveDirection(\"down\");\r\n                    }\r\n                    break;\r\n                }\r\n                case \"ThirdLevel\":{\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"level2\"));\r\n                    createQuadTexture(0, 0, 640, 360);\r\n\r\n                    for (Mob mob : SingletonMobs.mobList) {\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall1\")))\r\n                            mob.stopRight();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall3\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                            mob.stopLeft();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall5\")))\r\n                            mob.stopUp();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall2\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall6\")))\r\n                            mob.stopDown();\r\n                    }\r\n\r\n                    // Проверка перехода на второй уровень\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceFromThirdToSecondLevel\"))) {\r\n                        level = \"SecondLevel\";\r\n                        // Обновление хитбоксов стен для второго уровня\r\n                        for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.secondLevelWalls[j], Storage.secondLevelWalls[j + 1],\r\n                                    Storage.secondLevelWalls[j + 2], Storage.secondLevelWalls[j + 3]);\r\n                        }\r\n                        SingletonPlayer.player.setX(180);\r\n                        SingletonPlayer.player.setY(120);\r\n                        SingletonPlayer.player.setMoveDirection(\"down\");\r\n                    }\r\n                    break;\r\n                }\r\n                case \"ForthLevel\":{\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"level3\"));\r\n                    createQuadTexture(0, 0, 640, 360);\r\n\r\n                    for (Mob mob : SingletonMobs.mobList) {\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall1\")))\r\n                            mob.stopRight();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall3\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall4\")))\r\n                            mob.stopLeft();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall0\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall5\")))\r\n                            mob.stopUp();\r\n                        if (AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall2\")) || AABB.AABBvsAABB(mob.getCollisionBox(), aabbMap.get(\"wall6\")))\r\n                            mob.stopDown();\r\n                    }\r\n\r\n                    if (!mobSpawnStarted) {\r\n                        mobSpawnStarted = true;\r\n                        mobTimer.schedule(mobSpawnTask, 3000, 10000);\r\n                    }\r\n\r\n                    // Все операции с мобами\r\n                    for (int i = 1; i < SingletonMobs.mobList.size(); i++) {\r\n                        if (!SingletonMobs.mobList.get(i).isDead()) {\r\n                            if (SingletonMobs.mobList.get(i) instanceof Imp) {\r\n                                Imp imp = (Imp) SingletonMobs.mobList.get(i);\r\n                                if (imp.isAttackLeft() || imp.isAttackRight() || imp.isAttackUp() || imp.isAttackDown()) glBindTexture(GL_TEXTURE_2D, textureMap.get(\"imp\" + imp.getMoveDirection() + \"_attack_0\" + imp.getHitAnimationTime()));\r\n                                else glBindTexture(GL_TEXTURE_2D, textureMap.get(\"imp\" + imp.getMoveDirection() + \"_move_0\" + imp.getAnimationTime()));\r\n                                createQuadTexture(imp.getX(), imp.getY(), imp.getX() + 64, imp.getY() + 64);\r\n                                imp.update();\r\n\r\n                                // Игрок получает урона от паука\r\n                                if (AABB.AABBvsAABB(SingletonPlayer.player.getHitbox(), imp.getAttackBox()) &&\r\n                                        !SingletonPlayer.player.isDead() && !SingletonPlayer.player.isImmortal()) {\r\n                                    if (imp.isAttackLeft()) SingletonPlayer.player.setKnockbackDirection(\"left\");\r\n                                    else if (imp.isAttackRight()) SingletonPlayer.player.setKnockbackDirection(\"right\");\r\n                                    else if (imp.isAttackUp()) SingletonPlayer.player.setKnockbackDirection(\"up\");\r\n                                    else if (imp.isAttackDown()) SingletonPlayer.player.setKnockbackDirection(\"down\");\r\n                                    SingletonPlayer.player.takeDamage(imp.getDamage());\r\n                                    if (!SingletonPlayer.player.isKnockbackTaskStarted()) {\r\n                                        SingletonPlayer.player.setImmortal(true);\r\n                                        SingletonPlayer.player.getTimer().schedule(SingletonPlayer.player.getKnockbackTask(), 0, 10);\r\n                                    }\r\n                                }\r\n\r\n                                // Смэрть\r\n                                if (imp.getHealth() <= 0) {\r\n                                    imp.setDead(true);\r\n                                    /*imp.getTimer().cancel();\r\n                                    imp.getTimer().purge();*/\r\n                                    SingletonMobs.mobList.remove(imp);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Проверка перехода на второй уровень\r\n                    if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get(\"entranceFromForthToSecondLevel\"))) {\r\n                        level = \"SecondLevel\";\r\n                        // Обновление хитбоксов стен для второго уровня\r\n                        for (int i = 0, j = 0; i < 7; i++, j+=4) {\r\n                            aabbMap.get(\"wall\" + i).update(Storage.secondLevelWalls[j], Storage.secondLevelWalls[j + 1],\r\n                                    Storage.secondLevelWalls[j + 2], Storage.secondLevelWalls[j + 3]);\r\n                        }\r\n                        SingletonPlayer.player.setX(240);\r\n                        SingletonPlayer.player.setY(120);\r\n                        SingletonPlayer.player.setMoveDirection(\"down\");\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n\r\n            // Отрисовка интерфейса\r\n            if (!level.equals(\"MainMenu\") && !level.equals(\"Town\")) {\r\n                // Полоска здоровья\r\n                int tempHealth = SingletonPlayer.player.getHealth() % 10 == 0 ? SingletonPlayer.player.getHealth() : SingletonPlayer.player.getHealth() - (SingletonPlayer.player.getHealth() % 10) + 10;\r\n                if (tempHealth >= 0) glBindTexture(GL_TEXTURE_2D, textureMap.get(tempHealth + \"hp\"));\r\n                if (SingletonPlayer.player.getHealth() <= 0) {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"0hp\"));\r\n                    SingletonPlayer.player.setDead(true);\r\n                }\r\n                createQuadTexture(0, 0, 103, 18);\r\n\r\n                // Щит с броней\r\n                int tempArmor = SingletonPlayer.player.getArmor() % 5 == 0 ? SingletonPlayer.player.getArmor() : SingletonPlayer.player.getArmor() - (SingletonPlayer.player.getArmor() % 5);\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(tempArmor + \"armor\"));\r\n                createQuadTexture(0, 20, 60, 40);\r\n\r\n                // Количество монет\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(\"coin_0\" + coinGUI.getAnimationTime()));\r\n                createQuadTexture(0, 42, 11, 54);\r\n                int tempCoin = SingletonPlayer.player.getMoney();\r\n                int tempX0 = 13 + (getCountsOfDigits(SingletonPlayer.player.getMoney()) * 7) - 7, tempX1 = 13 + (getCountsOfDigits(SingletonPlayer.player.getMoney()) * 7), tempY0 = 44, tempY1 = 54;\r\n                for (int i = 0; i < getCountsOfDigits(SingletonPlayer.player.getMoney()); i++) {\r\n                    switch (tempCoin % 10) {\r\n                        case 0:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_0\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 1:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_1\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 2:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_2\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 3:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_3\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 4:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_4\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 5:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_5\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 6:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_6\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 7:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_7\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 8:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_8\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 9:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_9\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n\r\n                    }\r\n                    tempCoin = tempCoin / 10;\r\n                    tempX0 -= 7;\r\n                    tempX1 -= 7;\r\n                }\r\n\r\n                // Количество ключей\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(\"keyGold\"));\r\n                createQuadTexture(0, 55, 16, 61);\r\n                int tempKeys = SingletonPlayer.player.getKeys();\r\n                tempX0 = 16 + (getCountsOfDigits(SingletonPlayer.player.getKeys()) * 7) - 7;\r\n                tempX1 = 16 + (getCountsOfDigits(SingletonPlayer.player.getKeys()) * 7);\r\n                tempY0 = 55;\r\n                tempY1 = 65;\r\n                for (int i = 0; i < getCountsOfDigits(SingletonPlayer.player.getKeys()); i++) {\r\n                    switch (tempKeys % 10) {\r\n                        case 0:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_0\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 1:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_1\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 2:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_2\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 3:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_3\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 4:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_4\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 5:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_5\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 6:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_6\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 7:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_7\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 8:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_8\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n                        case 9:\r\n                            glBindTexture(GL_TEXTURE_2D, textureMap.get(\"number_9\"));\r\n                            createQuadTexture(tempX0, tempY0, tempX1, tempY1);\r\n                            break;\r\n\r\n                    }\r\n                    tempKeys = tempKeys / 10;\r\n                    tempX0 -= 7;\r\n                    tempX1 -= 7;\r\n                }\r\n            }\r\n\r\n            // Отрисовка экипировки и анимации\r\n            SingletonPlayer.player.update(window, level);\r\n            glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getBodyAnimation()));\r\n            createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            if (!SingletonPlayer.player.getFeetTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getFeetAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getLegsTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getLegsAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getTorsoTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getTorsoAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getOverTorsoTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getOverTorsoAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getShouldersTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getShouldersAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getBeltTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getBeltAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getHeadTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getHeadAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if (!SingletonPlayer.player.getHandsTexture().equals(\"nothing\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getHandsAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX(), SingletonPlayer.player.getY(), SingletonPlayer.player.getX() + 64, SingletonPlayer.player.getY() + 64);\r\n            }\r\n            if ((SingletonPlayer.player.isAttackLeft() || SingletonPlayer.player.isAttackRight() || SingletonPlayer.player.isAttackUp() ||\r\n                    SingletonPlayer.player.isAttackDown()) && !SingletonPlayer.player.isDead() && !level.equals(\"MainMenu\")) {\r\n                glBindTexture(GL_TEXTURE_2D, textureMap.get(SingletonPlayer.player.getWeaponAnimation()));\r\n                createQuadTexture(SingletonPlayer.player.getX() - SingletonPlayer.player.getWeapon().getMinX(), SingletonPlayer.player.getY() - SingletonPlayer.player.getWeapon().getMinY(),\r\n                        SingletonPlayer.player.getX() + SingletonPlayer.player.getWeapon().getMaxX(), SingletonPlayer.player.getY() + SingletonPlayer.player.getWeapon().getMaxY());\r\n            }\r\n\r\n            if (!level.equals(\"MainMenu\") && SingletonPlayer.player.isScrollMenu()) {\r\n                if (level.equals(\"Town\")) {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"scrollMenu_\" + SingletonPlayer.player.getMenuChoice())); // Фон второстепенного меню\r\n                    createQuadTexture(SingletonPlayer.player.getForPlacingCamera(), 0, SingletonPlayer.player.getForPlacingCamera() + 640, 360);\r\n                }\r\n                else {\r\n                    glBindTexture(GL_TEXTURE_2D, textureMap.get(\"scrollMenu_\" + SingletonPlayer.player.getMenuChoice())); // Фон второстепенного меню\r\n                    createQuadTexture(0, 0, 640, 360);\r\n                }\r\n            }\r\n\r\n            glfwPollEvents();\r\n            glfwSwapBuffers(window);\r\n        }\r\n    }\r\n\r\n    private void createQuadTexture(int xMin, int yMin, int xMax, int yMax) {\r\n        glBegin(GL_QUADS);\r\n        glTexCoord2d(0, 0);\r\n        glVertex2f(xMin, yMin);\r\n        glTexCoord2d(1, 0);\r\n        glVertex2f(xMax, yMin);\r\n        glTexCoord2d(1, 1);\r\n        glVertex2f(xMax, yMax);\r\n        glTexCoord2d(0, 1);\r\n        glVertex2f(xMin, yMax);\r\n        glEnd();\r\n    }\r\n\r\n    void reshape(int w, int h) {\r\n        glViewport(0, 0, w, h);\r\n        glMatrixMode(GL_PROJECTION);\r\n        glLoadIdentity();\r\n        glOrtho(0, w, h, 0, 1, -1);\r\n        glMatrixMode(GL_MODELVIEW);\r\n        if (forScale) {\r\n            glScaled(3, 3, 1);\r\n            forScale = false;\r\n        }\r\n    }\r\n\r\n    public static int getCountsOfDigits(long number) {\r\n        return (number == 0) ? 1 : (int) Math.ceil(Math.log10(Math.abs(number) + 0.5));\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/Window.java	(revision 4265b0c6084084c2802b43ef93d11a89f3914490)
+++ src/Window.java	(date 1598281233563)
@@ -54,7 +54,7 @@
             else if (level.equals("SecondLevel")) SingletonMobs.mobList.add(new Spider(477, 284, 1, 60, 0, 10));
             else if (level.equals("ForthLevel")) SingletonMobs.mobList.add(new Imp(477, 284, 1, 60, 0, 30));
             time++;
-            if (time == 6) stopMobSpawn();
+            if (time == 1) stopMobSpawn();
         }
     };
 
@@ -68,9 +68,9 @@
             public void run() {
                 if (level.equals("FirstLevel")) SingletonMobs.mobList.add(new Slime(350, 300, 1, 50, 0, 5));
                 else if (level.equals("SecondLevel")) SingletonMobs.mobList.add(new Spider(477, 284, 1, 60, 0, 10));
-                else if (level.equals("ForthLevel")) SingletonMobs.mobList.add(new Imp(477, 284, 1, 60, 0, 30));
+                else if (level.equals("ForthLevel")) SingletonMobs.mobList.add(new Imp(477, 284, 1, 400, 0, 50));
                 time++;
-                if (time == 2) stopMobSpawn();
+                if (time == 1) stopMobSpawn();
             }
         };
     }
@@ -189,9 +189,10 @@
                 if (SingletonPlayer.player.isYes()) {
                     level = "FirstLevel";
                     glTranslated(SingletonPlayer.player.getForPlacingCamera(), 0, 0);
-                    SingletonPlayer.player.setX(150);
-                    SingletonPlayer.player.setY(150);
+                    SingletonPlayer.player.setX(199);
+                    SingletonPlayer.player.setY(273);
                     SingletonPlayer.player.setSpeed(2);
+                    SingletonPlayer.player.setMoveDirection("up");
                 }
                 // Установление хитбоксов стен первого уровня
                 for(int i = 0, j = 0; i < 5; i++, j+=4)
@@ -919,6 +920,7 @@
                     // Проверка перехода на 4 уровень
                     if (AABB.AABBvsAABB(SingletonPlayer.player.getCollisionBox(), aabbMap.get("entranceToForthLevel"))) {
                         level = "ForthLevel";
+                        mobSpawnStarted = false;
                         // Обновление хитбоксов стен для 4 уровня
                         for (int i = 0, j = 0; i < 7; i++, j+=4) {
                             aabbMap.get("wall" + i).update(Storage.fourthLevelWalls[j], Storage.fourthLevelWalls[j + 1],
@@ -980,12 +982,13 @@
                     }
 
                     // Все операции с мобами
-                    for (int i = 1; i < SingletonMobs.mobList.size(); i++) {
+                    for (int i = 0; i < SingletonMobs.mobList.size(); i++) {
                         if (!SingletonMobs.mobList.get(i).isDead()) {
                             if (SingletonMobs.mobList.get(i) instanceof Imp) {
                                 Imp imp = (Imp) SingletonMobs.mobList.get(i);
-                                if (imp.isAttackLeft() || imp.isAttackRight() || imp.isAttackUp() || imp.isAttackDown()) glBindTexture(GL_TEXTURE_2D, textureMap.get("imp" + imp.getMoveDirection() + "_attack_0" + imp.getHitAnimationTime()));
-                                else glBindTexture(GL_TEXTURE_2D, textureMap.get("imp" + imp.getMoveDirection() + "_move_0" + imp.getAnimationTime()));
+                                if (imp.isAttackLeft() || imp.isAttackRight() ||imp.isAttackUp() || imp.isAttackDown())
+                                    glBindTexture(GL_TEXTURE_2D, textureMap.get("imp_" + imp.getMoveDirection() + "_attack_0" + imp.getHitAnimationTime()));
+                                else glBindTexture(GL_TEXTURE_2D, textureMap.get("imp_" + imp.getMoveDirection() + "_move_0" + imp.getAnimationTime()));
                                 createQuadTexture(imp.getX(), imp.getY(), imp.getX() + 64, imp.getY() + 64);
                                 imp.update();
 
Index: src/mobs/Slime.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package mobs;\r\n\r\nimport content.AudioMaster;\r\nimport content.Source;\r\nimport content.Storage;\r\nimport math.AABB;\r\nimport math.CollisionMessage;\r\n\r\nimport java.util.Timer;\r\nimport java.util.TimerTask;\r\n\r\npublic class Slime extends Mob {\r\n    private int knockbackTime = 0, animationTime = 1;\r\n    private String knockbackDirection;\r\n    private Source hurtSound;\r\n    private int hurtSoundId, deathSoundId;\r\n    private boolean animationTaskStarted = false, knockbackTaskStarted = false;\r\n    private TimerTask knockbackTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            setImmortal(true);\r\n            knockbackTaskStarted = true;\r\n            switch (knockbackDirection) {\r\n                case \"left\":\r\n                    knockBackLeft();\r\n                    break;\r\n                case \"right\":\r\n                    knockBackRight();\r\n                    break;\r\n                case \"up\":\r\n                    knockBackUp();\r\n                    break;\r\n                case \"down\":\r\n                    knockBackDown();\r\n                    break;\r\n            }\r\n            knockbackTime++;\r\n            if (knockbackTime >= 25) stopTimer();\r\n        }\r\n    };\r\n    private TimerTask animationTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            animationTaskStarted = true;\r\n            animationTime++;\r\n            if (animationTime == 4) animationTime = 1;\r\n        }\r\n    };\r\n\r\n    public Slime(int x, int y, int speed, int health, int armor, int damage) {\r\n        super(x, y, speed, health, armor, damage, new AABB(), new AABB());\r\n        getHitbox().update(getX() + 3, getY() + 2, getX() + 14, getY() + 10);\r\n        getCollisionBox().update(getX() + 1, getY() + 1, getX() + 16, getY() + 11);\r\n        setMoveDirection(\"left\");\r\n        hurtSound = new Source(0);\r\n        hurtSoundId = AudioMaster.loadSound(\"sounds/\" + Storage.slimeSoundString[0]);\r\n        deathSoundId = AudioMaster.loadSound(\"sounds/\" + Storage.slimeSoundString[1]);\r\n    }\r\n\r\n    public void stopTimer() {\r\n        knockbackTime = 0;\r\n        setImmortal(false);\r\n        getTimer().cancel();\r\n        getTimer().purge();\r\n        setTimer(new Timer());\r\n        knockbackTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                setImmortal(true);\r\n                knockbackTaskStarted = true;\r\n                switch (knockbackDirection) {\r\n                    case \"left\":\r\n                        knockBackLeft();\r\n                        break;\r\n                    case \"right\":\r\n                        knockBackRight();\r\n                        break;\r\n                    case \"up\":\r\n                        knockBackUp();\r\n                        break;\r\n                    case \"down\":\r\n                        knockBackDown();\r\n                        break;\r\n                }\r\n                knockbackTime++;\r\n                if (knockbackTime >= 25) stopTimer();\r\n            }\r\n        };\r\n        animationTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                animationTaskStarted = true;\r\n                animationTime++;\r\n                if (animationTime == 4) animationTime = 1;\r\n            }\r\n        };\r\n        knockbackTaskStarted = false;\r\n        animationTaskStarted = false;\r\n    }\r\n\r\n    public synchronized void simulate() {\r\n        if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&\r\n                animationTime == 3) moveUpLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&\r\n                animationTime == 3) moveUpRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&\r\n                animationTime == 3) moveDownLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&\r\n                animationTime == 3) moveDownRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&\r\n                animationTime == 3) moveLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&\r\n                 animationTime == 3) moveRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                animationTime == 3) moveUp();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                animationTime == 3) moveDown();\r\n    }\r\n\r\n    public void update() {\r\n        // Слизень получает урон от игрока\r\n        if (AABB.AABBvsAABB(SingletonPlayer.player.getAttackBox(), getHitbox()) && !isImmortal()) {\r\n            if (SingletonPlayer.player.isAttackLeft()) setKnockbackDirection(\"left\");\r\n            else if (SingletonPlayer.player.isAttackRight()) setKnockbackDirection(\"right\");\r\n            else if (SingletonPlayer.player.isAttackUp()) setKnockbackDirection(\"up\");\r\n            else if (SingletonPlayer.player.isAttackDown()) setKnockbackDirection(\"down\");\r\n            setHealth(getHealth() - SingletonPlayer.player.getDamage());\r\n            if (!isKnockbackTaskStarted()) getTimer().schedule(getKnockbackTask(), 0, 10);\r\n\r\n            if (getHealth() <= 0) hurtSound.play(deathSoundId);\r\n            else hurtSound.play(hurtSoundId);\r\n        }\r\n\r\n        // Столкновение с другими мобами\r\n        for (Mob mob : SingletonMobs.mobList) {\r\n            if (!(mob instanceof Player) && AABB.AABBvsAABB2(getCollisionBox(), mob.getCollisionBox()))\r\n                stop(CollisionMessage.getMessage());\r\n        }\r\n\r\n        if (!isAnimationTaskStarted()) getTimer().schedule(getAnimationTask(), 0, 300);\r\n        getHitbox().update(getX() + 3, getY() + 2, getX() + 14, getY() + 10);\r\n        getCollisionBox().update(getX() + 1, getY() + 1, getX() + 16, getY() + 11);\r\n\r\n        // Преследование игрока\r\n        if (!SingletonPlayer.player.isScrollMenu() && !knockbackTaskStarted) {\r\n            if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&\r\n                    animationTime == 3) moveUpLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&\r\n                    animationTime == 3) moveUpRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&\r\n                    animationTime == 3) moveDownLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&\r\n                    animationTime == 3) moveDownRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&\r\n                    animationTime == 3) moveLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&\r\n                    animationTime == 3) moveRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    animationTime == 3) moveUp();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    animationTime == 3) moveDown();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void moveUp() { setY(getY() - getSpeed()); }\r\n\r\n    @Override\r\n    public void moveDown() { setY(getY() + getSpeed()); }\r\n\r\n    public TimerTask getKnockbackTask() { return knockbackTask; }\r\n\r\n    public TimerTask getAnimationTask() { return animationTask; }\r\n\r\n    public int getKnockbackTime() { return knockbackTime; }\r\n\r\n    public int getAnimationTime() { return animationTime; }\r\n\r\n    public boolean isAnimationTaskStarted() { return animationTaskStarted; }\r\n\r\n    public void setAnimationTaskStarted(boolean animationTaskStarted) { this.animationTaskStarted = animationTaskStarted; }\r\n\r\n    public void setKnockbackDirection(String knockbackDirection) { this.knockbackDirection = knockbackDirection; }\r\n\r\n    public boolean isKnockbackTaskStarted() { return knockbackTaskStarted; }\r\n\r\n    public void setKnockbackTaskStarted(boolean knockbackTaskStarted) { this.knockbackTaskStarted = knockbackTaskStarted; }\r\n\r\n    public int getHurtSoundId() { return hurtSoundId; }\r\n\r\n    public Source getHurtSound() { return hurtSound; }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/mobs/Slime.java	(revision 4265b0c6084084c2802b43ef93d11a89f3914490)
+++ src/mobs/Slime.java	(date 1598276209843)
@@ -98,36 +98,6 @@
         animationTaskStarted = false;
     }
 
-    public synchronized void simulate() {
-        if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&
-                animationTime == 3) moveUpLeft();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&
-                animationTime == 3) moveUpRight();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&
-                animationTime == 3) moveDownLeft();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&
-                animationTime == 3) moveDownRight();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x &&
-                animationTime == 3) moveLeft();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x &&
-                 animationTime == 3) moveRight();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&
-                animationTime == 3) moveUp();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&
-                animationTime == 3) moveDown();
-    }
-
     public void update() {
         // Слизень получает урон от игрока
         if (AABB.AABBvsAABB(SingletonPlayer.player.getAttackBox(), getHitbox()) && !isImmortal()) {
Index: src/mobs/Spider.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package mobs;\r\n\r\nimport math.AABB;\r\nimport math.CollisionMessage;\r\n\r\nimport java.util.Timer;\r\nimport java.util.TimerTask;\r\n\r\npublic class Spider extends Mob {\r\n    private int knockbackTime = 0, animationTime = 2, hitAnimationTime = 0;\r\n    private String knockbackDirection;\r\n    private boolean animationTaskStarted = false, knockbackTaskStarted = false, hitAnimationTaskStarted = false;\r\n    private boolean isAttackRight = false, isAttackLeft = false, isAttackUp = false, isAttackDown = false;\r\n    private AABB attackBox;\r\n    private TimerTask knockbackTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            knockbackTaskStarted = true;\r\n            if (knockbackDirection.equals(\"left\")) knockBackLeft();\r\n            else if (knockbackDirection.equals(\"right\")) knockBackRight();\r\n            else if (knockbackDirection.equals(\"up\")) knockBackUp();\r\n            else if (knockbackDirection.equals(\"down\")) knockBackDown();\r\n            knockbackTime++;\r\n        }\r\n    };\r\n    private TimerTask animationTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            animationTaskStarted = true;\r\n            animationTime++;\r\n            if (animationTime == 8) animationTime = 2;\r\n        }\r\n    };\r\n    private TimerTask hitAnimationTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            hitAnimationTaskStarted = true;\r\n            hitAnimationTime++;\r\n            if (hitAnimationTime == 2) {\r\n                if (isAttackLeft) attackBox.update(getX() + 4, getY() + 24, getX() + 14, getY() + 48);\r\n                else if (isAttackRight) attackBox.update(getX() + 49, getY() + 24, getX() + 59, getY() + 48);\r\n                else if (isAttackUp) attackBox.update(getX() + 16, getY() + 11, getX() + 45, getY() + 19);\r\n                else if (isAttackDown) attackBox.update(getX() + 16, getY() + 43, getX() + 45, getY() + 54);\r\n            }\r\n            if (hitAnimationTime == 4) {\r\n                hitAnimationTime = 0;\r\n                isAttackLeft = isAttackRight = isAttackUp = isAttackDown = false;\r\n                stopTimer();\r\n            }\r\n        }\r\n    };\r\n\r\n    public Spider(int x, int y, int speed, int health, int armor, int damage) {\r\n        super(x, y, speed, health, armor, damage, new AABB(), new AABB());\r\n        attackBox = new AABB();\r\n        getHitbox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n        getCollisionBox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n        setMoveDirection(\"left\");\r\n    }\r\n\r\n    public void stopTimer() {\r\n        knockbackTime = 0;\r\n        setImmortal(false);\r\n        getTimer().cancel();\r\n        getTimer().purge();\r\n        setTimer(new Timer());\r\n        knockbackTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                knockbackTaskStarted = true;\r\n                if (knockbackDirection.equals(\"left\")) knockBackLeft();\r\n                else if (knockbackDirection.equals(\"right\")) knockBackRight();\r\n                else if (knockbackDirection.equals(\"up\")) knockBackUp();\r\n                else if (knockbackDirection.equals(\"down\")) knockBackDown();\r\n                knockbackTime++;\r\n            }\r\n        };\r\n        animationTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                animationTaskStarted = true;\r\n                animationTime++;\r\n                if (animationTime == 8) animationTime = 2;\r\n            }\r\n        };\r\n        hitAnimationTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                hitAnimationTaskStarted = true;\r\n                hitAnimationTime++;\r\n                if (hitAnimationTime == 2) {\r\n                    if (isAttackLeft) attackBox.update(getX() + 4, getY() + 24, getX() + 14, getY() + 48);\r\n                    else if (isAttackRight) attackBox.update(getX() + 49, getY() + 24, getX() + 59, getY() + 48);\r\n                    else if (isAttackUp) attackBox.update(getX() + 16, getY() + 11, getX() + 45, getY() + 19);\r\n                    else if (isAttackDown) attackBox.update(getX() + 16, getY() + 43, getX() + 45, getY() + 54);\r\n                }\r\n                if (hitAnimationTime == 4) {\r\n                    isAttackLeft = isAttackRight = isAttackUp = isAttackDown = false;\r\n                    hitAnimationTime = 0;\r\n                    stopTimer();\r\n                }\r\n            }\r\n        };\r\n        animationTaskStarted = false;\r\n        hitAnimationTaskStarted = false;\r\n    }\r\n\r\n    public void simulate() {\r\n        if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveUpLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveUpRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveDownLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveDownRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y) moveUp();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y) moveDown();\r\n    }\r\n\r\n    public void update() {\r\n        if (knockbackTime >= 25) stopTimer();\r\n\r\n        // Паук получает урон от игрока\r\n        if (AABB.AABBvsAABB(SingletonPlayer.player.getAttackBox(), getHitbox()) && !isImmortal()) {\r\n            if (SingletonPlayer.player.isAttackLeft()) setKnockbackDirection(\"left\");\r\n            else if (SingletonPlayer.player.isAttackRight()) setKnockbackDirection(\"right\");\r\n            else if (SingletonPlayer.player.isAttackUp()) setKnockbackDirection(\"up\");\r\n            else if (SingletonPlayer.player.isAttackDown()) setKnockbackDirection(\"down\");\r\n            setHealth(getHealth() - SingletonPlayer.player.getDamage());\r\n            if (!isKnockbackTaskStarted()) {\r\n                setImmortal(true);\r\n                getTimer().schedule(getKnockbackTask(), 0, 10);\r\n            }\r\n        }\r\n\r\n        // Паук наносит удар при соприкосновении с игроком\r\n        if (AABB.AABBvsAABB2(getHitbox(), SingletonPlayer.player.getHitbox())) {\r\n            switch (CollisionMessage.getMessage()) {\r\n                case \"left\":\r\n                    isAttackLeft = true;\r\n                    if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n                    break;\r\n                case \"right\":\r\n                    isAttackRight = true;\r\n                    if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n                    break;\r\n                case \"up\":\r\n                    isAttackUp = true;\r\n                    if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n                    break;\r\n                case \"down\":\r\n                    isAttackDown = true;\r\n                    if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        for (Mob mob : SingletonMobs.mobList) {\r\n            if (/*!(mob instanceof Player) && */AABB.AABBvsAABB2(getCollisionBox(), mob.getCollisionBox()))\r\n                stop(CollisionMessage.getMessage());\r\n        }\r\n\r\n        if (!isAnimationTaskStarted()) getTimer().schedule(getAnimationTask(), 0, 150);\r\n        getHitbox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n        getCollisionBox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n\r\n        // Преследование игрока\r\n        if (!SingletonPlayer.player.isScrollMenu() && (!isAttackLeft || !isAttackRight || !isAttackUp || !isAttackDown) &&\r\n                !knockbackTaskStarted) {\r\n            if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveUpLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveUpRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveDownLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveDownRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y) moveUp();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y) moveDown();\r\n        }\r\n    }\r\n\r\n    public TimerTask getKnockbackTask() { return knockbackTask; }\r\n\r\n    public TimerTask getAnimationTask() { return animationTask; }\r\n\r\n    public int getAnimationTime() { return animationTime; }\r\n\r\n    public int getHitAnimationTime() { return hitAnimationTime; }\r\n\r\n    public boolean isAnimationTaskStarted() { return animationTaskStarted; }\r\n\r\n    public void setKnockbackDirection(String knockbackDirection) { this.knockbackDirection = knockbackDirection; }\r\n\r\n    public boolean isKnockbackTaskStarted() { return knockbackTaskStarted; }\r\n\r\n    public void setKnockbackTaskStarted(boolean knockbackTaskStarted) { this.knockbackTaskStarted = knockbackTaskStarted; }\r\n\r\n    public boolean isHitAnimationTaskStarted() { return hitAnimationTaskStarted; }\r\n\r\n    public void setHitAnimationTaskStarted(boolean hitAnimationTaskStarted) { this.hitAnimationTaskStarted = hitAnimationTaskStarted; }\r\n\r\n    public boolean isAttackRight() { return isAttackRight; }\r\n\r\n    public boolean isAttackLeft() { return isAttackLeft; }\r\n\r\n    public boolean isAttackUp() { return isAttackUp; }\r\n\r\n    public boolean isAttackDown() { return isAttackDown; }\r\n\r\n    public AABB getAttackBox() { return attackBox; }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/mobs/Spider.java	(revision 4265b0c6084084c2802b43ef93d11a89f3914490)
+++ src/mobs/Spider.java	(date 1598276428291)
@@ -15,12 +15,14 @@
     private TimerTask knockbackTask = new TimerTask() {
         @Override
         public void run() {
+            setImmortal(true);
             knockbackTaskStarted = true;
             if (knockbackDirection.equals("left")) knockBackLeft();
             else if (knockbackDirection.equals("right")) knockBackRight();
             else if (knockbackDirection.equals("up")) knockBackUp();
             else if (knockbackDirection.equals("down")) knockBackDown();
             knockbackTime++;
+            if (knockbackTime >= 25) stopTimer();
         }
     };
     private TimerTask animationTask = new TimerTask() {
@@ -67,12 +69,14 @@
         knockbackTask = new TimerTask() {
             @Override
             public void run() {
+                setImmortal(true);
                 knockbackTaskStarted = true;
                 if (knockbackDirection.equals("left")) knockBackLeft();
                 else if (knockbackDirection.equals("right")) knockBackRight();
                 else if (knockbackDirection.equals("up")) knockBackUp();
                 else if (knockbackDirection.equals("down")) knockBackDown();
                 knockbackTime++;
+                if (knockbackTime >= 25) stopTimer();
             }
         };
         animationTask = new TimerTask() {
@@ -103,33 +107,10 @@
         };
         animationTaskStarted = false;
         hitAnimationTaskStarted = false;
-    }
-
-    public void simulate() {
-        if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveUpLeft();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveUpRight();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveDownLeft();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&
-                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveDownRight();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveLeft();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveRight();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y) moveUp();
-
-        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y) moveDown();
+        knockbackTaskStarted = false;
     }
 
     public void update() {
-        if (knockbackTime >= 25) stopTimer();
-
         // Паук получает урон от игрока
         if (AABB.AABBvsAABB(SingletonPlayer.player.getAttackBox(), getHitbox()) && !isImmortal()) {
             if (SingletonPlayer.player.isAttackLeft()) setKnockbackDirection("left");
@@ -137,10 +118,7 @@
             else if (SingletonPlayer.player.isAttackUp()) setKnockbackDirection("up");
             else if (SingletonPlayer.player.isAttackDown()) setKnockbackDirection("down");
             setHealth(getHealth() - SingletonPlayer.player.getDamage());
-            if (!isKnockbackTaskStarted()) {
-                setImmortal(true);
-                getTimer().schedule(getKnockbackTask(), 0, 10);
-            }
+            if (!isKnockbackTaskStarted()) getTimer().schedule(getKnockbackTask(), 0, 10);
         }
 
         // Паук наносит удар при соприкосновении с игроком
Index: src/mobs/Imp.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package mobs;\r\n\r\nimport math.AABB;\r\nimport math.CollisionMessage;\r\n\r\nimport java.util.Timer;\r\nimport java.util.TimerTask;\r\n\r\npublic class Imp extends Mob {\r\n    private int knockbackTime = 0, animationTime = 2, hitAnimationTime = 1;\r\n    private String knockbackDirection;\r\n    private boolean animationTaskStarted = false, knockbackTaskStarted = false, hitAnimationTaskStarted = false;\r\n    private boolean isAttackRight = false, isAttackLeft = false, isAttackUp = false, isAttackDown = false;\r\n    private AABB attackBox;\r\n    private TimerTask knockbackTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            setImmortal(true);\r\n            knockbackTaskStarted = true;\r\n            if (knockbackDirection.equals(\"left\")) knockBackLeft();\r\n            else if (knockbackDirection.equals(\"right\")) knockBackRight();\r\n            else if (knockbackDirection.equals(\"up\")) knockBackUp();\r\n            else if (knockbackDirection.equals(\"down\")) knockBackDown();\r\n            knockbackTime++;\r\n        }\r\n    };\r\n    private TimerTask animationTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            animationTaskStarted = true;\r\n            animationTime++;\r\n            if (animationTime == 8) animationTime = 2;\r\n        }\r\n    };\r\n    private TimerTask hitAnimationTask = new TimerTask() {\r\n        @Override\r\n        public void run() {\r\n            hitAnimationTaskStarted = true;\r\n            hitAnimationTime++;\r\n            if (hitAnimationTime == 2) {\r\n                if (isAttackLeft) attackBox.update(getX() + 4, getY() + 24, getX() + 14, getY() + 48);\r\n                else if (isAttackRight) attackBox.update(getX() + 49, getY() + 24, getX() + 59, getY() + 48);\r\n                else if (isAttackUp) attackBox.update(getX() + 16, getY() + 11, getX() + 45, getY() + 19);\r\n                else if (isAttackDown) attackBox.update(getX() + 16, getY() + 43, getX() + 45, getY() + 54);\r\n            }\r\n            if (hitAnimationTime == 4) {\r\n                hitAnimationTime = 1;\r\n                isAttackLeft = isAttackRight = isAttackUp = isAttackDown = false;\r\n                stopTimer();\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    public Imp(int x, int y, int speed, int health, int armor, int damage/*, AABB hitBox, AABB collisionBox*/) {\r\n        super(x, y, speed, health, armor, damage, new AABB(), new AABB());\r\n        attackBox = new AABB();\r\n        getHitbox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n        getCollisionBox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n        setMoveDirection(\"left\");\r\n    }\r\n\r\n    public void stopTimer() {\r\n        knockbackTime = 0;\r\n        setImmortal(false);\r\n        getTimer().cancel();\r\n        getTimer().purge();\r\n        setTimer(new Timer());\r\n        knockbackTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                setImmortal(true);\r\n                knockbackTaskStarted = true;\r\n                if (knockbackDirection.equals(\"left\")) knockBackLeft();\r\n                else if (knockbackDirection.equals(\"right\")) knockBackRight();\r\n                else if (knockbackDirection.equals(\"up\")) knockBackUp();\r\n                else if (knockbackDirection.equals(\"down\")) knockBackDown();\r\n                knockbackTime++;\r\n            }\r\n        };\r\n        animationTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                animationTaskStarted = true;\r\n                animationTime++;\r\n                if (animationTime == 8) animationTime = 2;\r\n            }\r\n        };\r\n        hitAnimationTask = new TimerTask() {\r\n            @Override\r\n            public void run() {\r\n                hitAnimationTaskStarted = true;\r\n                hitAnimationTime++;\r\n                if (hitAnimationTime == 2) {\r\n                    if (isAttackLeft) attackBox.update(getX() + 4, getY() + 24, getX() + 14, getY() + 48);\r\n                    else if (isAttackRight) attackBox.update(getX() + 49, getY() + 24, getX() + 59, getY() + 48);\r\n                    else if (isAttackUp) attackBox.update(getX() + 16, getY() + 11, getX() + 45, getY() + 19);\r\n                    else if (isAttackDown) attackBox.update(getX() + 16, getY() + 43, getX() + 45, getY() + 54);\r\n                }\r\n                if (hitAnimationTime == 4) {\r\n                    isAttackLeft = isAttackRight = isAttackUp = isAttackDown = false;\r\n                    hitAnimationTime = 1;\r\n                    stopTimer();\r\n                }\r\n            }\r\n        };\r\n        animationTaskStarted = false;\r\n        hitAnimationTaskStarted = false;\r\n    }\r\n\r\n    public void simulate() {\r\n        if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveUpLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveUpRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveDownLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveDownRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveLeft();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveRight();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y) moveUp();\r\n\r\n        else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y) moveDown();\r\n    }\r\n\r\n    public void update() {\r\n        if (knockbackTime >= 25) stopTimer();\r\n\r\n        // Паук получает урон от игрока\r\n        if (AABB.AABBvsAABB(SingletonPlayer.player.getAttackBox(), getHitbox()) && !isImmortal()) {\r\n            if (SingletonPlayer.player.isAttackLeft()) setKnockbackDirection(\"left\");\r\n            else if (SingletonPlayer.player.isAttackRight()) setKnockbackDirection(\"right\");\r\n            else if (SingletonPlayer.player.isAttackUp()) setKnockbackDirection(\"up\");\r\n            else if (SingletonPlayer.player.isAttackDown()) setKnockbackDirection(\"down\");\r\n            setHealth(getHealth() - SingletonPlayer.player.getDamage());\r\n            if (!isKnockbackTaskStarted()) getTimer().schedule(getKnockbackTask(), 0, 10);\r\n        }\r\n\r\n        if (AABB.AABBvsAABB2(getHitbox(), SingletonPlayer.player.getHitbox())) {\r\n            if (CollisionMessage.getMessage().equals(\"left\")) {\r\n                isAttackLeft = true;\r\n                if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n            }\r\n            else if (CollisionMessage.getMessage().equals(\"right\")) {\r\n                isAttackRight = true;\r\n                if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n            }\r\n            else if (CollisionMessage.getMessage().equals(\"up\")) {\r\n                isAttackUp = true;\r\n                if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n            }\r\n            else if (CollisionMessage.getMessage().equals(\"down\")) {\r\n                isAttackDown = true;\r\n                if (!hitAnimationTaskStarted) getTimer().schedule(hitAnimationTask, 0, 300);\r\n            }\r\n        }\r\n\r\n        for (Mob mob : SingletonMobs.mobList) {\r\n            if (!(mob instanceof Player) && AABB.AABBvsAABB2(getCollisionBox(), mob.getCollisionBox()))\r\n                stop(CollisionMessage.getMessage());\r\n        }\r\n\r\n        if (!isAnimationTaskStarted()) getTimer().schedule(getAnimationTask(), 0, 150);\r\n        getHitbox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n        getCollisionBox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);\r\n\r\n        if (!SingletonPlayer.player.isScrollMenu() && (!isAttackLeft || !isAttackRight || !isAttackUp || !isAttackDown)) {\r\n            if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveUpLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveUpRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveDownLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y &&\r\n                    SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveDownRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().x < getHitbox().getMin().x) moveLeft();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().x > getHitbox().getMin().x) moveRight();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y < getHitbox().getMin().y) moveUp();\r\n\r\n            else if (SingletonPlayer.player.getHitbox().getMin().y > getHitbox().getMin().y) moveDown();\r\n        }\r\n    }\r\n\r\n    public TimerTask getKnockbackTask() { return knockbackTask; }\r\n\r\n    public TimerTask getAnimationTask() { return animationTask; }\r\n\r\n    public int getAnimationTime() { return animationTime; }\r\n\r\n    public int getHitAnimationTime() { return hitAnimationTime; }\r\n\r\n    public boolean isAnimationTaskStarted() { return animationTaskStarted; }\r\n\r\n    public void setKnockbackDirection(String knockbackDirection) { this.knockbackDirection = knockbackDirection; }\r\n\r\n    public boolean isKnockbackTaskStarted() { return knockbackTaskStarted; }\r\n\r\n    public void setKnockbackTaskStarted(boolean knockbackTaskStarted) { this.knockbackTaskStarted = knockbackTaskStarted; }\r\n\r\n    public boolean isHitAnimationTaskStarted() { return hitAnimationTaskStarted; }\r\n\r\n    public void setHitAnimationTaskStarted(boolean hitAnimationTaskStarted) { this.hitAnimationTaskStarted = hitAnimationTaskStarted; }\r\n\r\n    public boolean isAttackRight() { return isAttackRight; }\r\n\r\n    public boolean isAttackLeft() { return isAttackLeft; }\r\n\r\n    public boolean isAttackUp() { return isAttackUp; }\r\n\r\n    public boolean isAttackDown() { return isAttackDown; }\r\n\r\n    public AABB getAttackBox() { return attackBox; }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/mobs/Imp.java	(revision 4265b0c6084084c2802b43ef93d11a89f3914490)
+++ src/mobs/Imp.java	(date 1598276460783)
@@ -22,6 +22,7 @@
             else if (knockbackDirection.equals("up")) knockBackUp();
             else if (knockbackDirection.equals("down")) knockBackDown();
             knockbackTime++;
+            if (knockbackTime >= 25) stopTimer();
         }
     };
     private TimerTask animationTask = new TimerTask() {
@@ -29,7 +30,7 @@
         public void run() {
             animationTaskStarted = true;
             animationTime++;
-            if (animationTime == 8) animationTime = 2;
+            if (animationTime == 5) animationTime = 2;
         }
     };
     private TimerTask hitAnimationTask = new TimerTask() {
@@ -43,7 +44,7 @@
                 else if (isAttackUp) attackBox.update(getX() + 16, getY() + 11, getX() + 45, getY() + 19);
                 else if (isAttackDown) attackBox.update(getX() + 16, getY() + 43, getX() + 45, getY() + 54);
             }
-            if (hitAnimationTime == 4) {
+            if (hitAnimationTime == 5) {
                 hitAnimationTime = 1;
                 isAttackLeft = isAttackRight = isAttackUp = isAttackDown = false;
                 stopTimer();
@@ -53,7 +54,7 @@
 
 
 
-    public Imp(int x, int y, int speed, int health, int armor, int damage/*, AABB hitBox, AABB collisionBox*/) {
+    public Imp(int x, int y, int speed, int health, int armor, int damage) {
         super(x, y, speed, health, armor, damage, new AABB(), new AABB());
         attackBox = new AABB();
         getHitbox().update(getX() + 10, getY() + 15, getX() + 51, getY() + 49);
@@ -77,6 +78,7 @@
                 else if (knockbackDirection.equals("up")) knockBackUp();
                 else if (knockbackDirection.equals("down")) knockBackDown();
                 knockbackTime++;
+                if (knockbackTime >= 25) stopTimer();
             }
         };
         animationTask = new TimerTask() {
@@ -84,7 +86,7 @@
             public void run() {
                 animationTaskStarted = true;
                 animationTime++;
-                if (animationTime == 8) animationTime = 2;
+                if (animationTime == 5) animationTime = 2;
             }
         };
         hitAnimationTask = new TimerTask() {
@@ -98,7 +100,7 @@
                     else if (isAttackUp) attackBox.update(getX() + 16, getY() + 11, getX() + 45, getY() + 19);
                     else if (isAttackDown) attackBox.update(getX() + 16, getY() + 43, getX() + 45, getY() + 54);
                 }
-                if (hitAnimationTime == 4) {
+                if (hitAnimationTime == 5) {
                     isAttackLeft = isAttackRight = isAttackUp = isAttackDown = false;
                     hitAnimationTime = 1;
                     stopTimer();
@@ -107,6 +109,7 @@
         };
         animationTaskStarted = false;
         hitAnimationTaskStarted = false;
+        knockbackTaskStarted = false;
     }
 
     public void simulate() {
@@ -132,8 +135,6 @@
     }
 
     public void update() {
-        if (knockbackTime >= 25) stopTimer();
-
         // Паук получает урон от игрока
         if (AABB.AABBvsAABB(SingletonPlayer.player.getAttackBox(), getHitbox()) && !isImmortal()) {
             if (SingletonPlayer.player.isAttackLeft()) setKnockbackDirection("left");
